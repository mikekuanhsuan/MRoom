
IT20202510301031_A類RM案件起案邏輯
5.4.1	新增每月RM批次A類案件（使用者預定的案件）
	如客戶符合以下任一條件，則將該客戶加入Ａ類
	前一個月曾被申報SAR
	前一個月曾有符合以下任一自定義情境條件（不論批次當下是否仍有效）：

1/1凌晨3點開始RM算分
但此時營業日12/31資料還沒進來 => 1/1晚上才開始處理
所以”前一個月”要怎麼定義 ?



--------------
技術核心問題：資料時間差 (Data Latency)
金融交易資料通常是 T+1（今天處理昨天的資料）。

1/1 凌晨 3 點執行批次時，資料只到 12/30，而 12/31 的資料尚未入庫。

結果：若此時執行「前一個月」的判斷，會漏掉 12/31，導致 A 類案件判斷錯誤。




5.4.1	新增每月RM批次A類案件（使用者預定的案件）
	如客戶符合以下任一條件，則將該客戶加入Ａ類
	前一個月曾被申報SAR
	前一個月曾有符合以下任一自定義情境條件（不論批次當下是否仍有效）：





假設今天是 3 月在跑 RM 批次，要判斷誰是 A 類：

客戶甲：2 月有被送 SAR → 3 月批次一定進 A 類。

客戶乙：2 月曾經因為「大額現金進出」符合你們的一個自定義情境，之後 2 月底就恢復正常 → 即使 3 月時情境已經不再觸發，3 月跑批次時仍要把客戶乙放進 A 類。

客戶丙：2 月沒有 SAR，也沒有觸發任何自定義情境 → 3 月就不會因這兩條而進 A 類。









對，你抓到關鍵點了：在這個情境下，「規則設計得再好」，只要作業時間不調整，問題就一定會發生：

12/31 是營業日，但交易資料是 T+1，系統在 1/1 白天或晚上才開始處理並寫入 12/31 的資料。

如果你在 1/1 凌晨 3 點就跑「每月 RM 批次」，此時資料庫裡「前一個月」實際只有到 12/30。

批次在判斷「前一個月曾被申報 SAR／曾符合情境」時，根本看不到 12/31 的事件，所以那天發生的 SAR / 情境觸發一定會被漏掉。

所以，要解的是「時間安排」而不是「業務規則文字」本身，可以考慮幾個方向（通常至少要選一個）：

調整 RM 批次時間

把「每月 RM 批次」排在 1/2（或 1/1 晚上資料確定跑完之後），確保 12/31 的資料已經入庫。

概念：先讓「前一個月的營業日資料全部到齊」，才做「前一個月」的判斷。

明確以「資料日期」為準

程式邏輯要釘死：「前一個月 = 12/1–12/31 的交易／事件日期」，而不是「批次執行日往前 N 天」。

但這仍然要搭配資料確實已經入庫，單靠定義不足以避開 T+1 的延遲。

補跑 / 校正機制

先在 1/1 凌晨用「12/1–12/30」暫跑一版 A 類名單。

等 12/31 的資料在 1/1 晚上或 1/2 早上入庫後，再跑一次「只補 12/31」的更新批次，把漏掉的客戶補進 A 類。

適合無法輕易改排程、又不能等太久才出名單的場景。
